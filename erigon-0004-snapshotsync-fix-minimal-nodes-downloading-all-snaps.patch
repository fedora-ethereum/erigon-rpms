From: milen <94537774+taratorio@users.noreply.github.com>
Date: Thu, 28 Aug 2025 11:00:59 +0100
Subject: [PATCH] snapshotsync: fix minimal nodes downloading all snapshots
 (#16862) (#16878)

cherry-pick 7e94129

---

fixes https://github.com/erigontech/erigon/issues/16852

checking the `blackListForPruning` was accidentally removed in
https://github.com/erigontech/erigon/pull/16648

diff of Downloader.Add logs (before/after fix):
https://www.diffchecker.com/MoE9EsyG/

diff --git a/turbo/snapshotsync/snapshotsync.go b/turbo/snapshotsync/snapshotsync.go
index 849b9cc13c..8093c6aa5f 100644
--- a/turbo/snapshotsync/snapshotsync.go
+++ b/turbo/snapshotsync/snapshotsync.go
@@ -449,6 +449,10 @@ func SyncSnapshots(
 				continue
 			}
 
+			if _, ok := blackListForPruning[p.Name]; ok {
+				continue
+			}
+
 			downloadRequest = append(downloadRequest, DownloadRequest{
 				Path:        p.Name,
 				TorrentHash: p.Hash,
